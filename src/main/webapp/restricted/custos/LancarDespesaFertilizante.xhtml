<ui:composition template="/WEB-INF/template/LayoutPadrao.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui">

	<ui:define name="titulo">Despesas com Fertilizantes e Defensivos</ui:define>

	<ui:define name="corpo">

		<h2>Despesas com Fertilizantes e Defensivos</h2>

		<h:form id="form">

			<p:toolbar id="toolbar">
				<p:toolbarGroup>
					<p:spacer width="10px" />
					<p:commandButton value="Adicionar Despesa"
						title="Adicionar despesa"
						style="margin-top: 10px; margin-bottom: 10px"
						icon="pi pi-user-plus"
						actionListener="#{lancarDespesaFertilizanteBean.limpar}"
						oncomplete="PF('addDialogWidgetVar').show()"
						update="addDialog toolbar" process="@this">
						<p:resetInput target="addDialog" />
					</p:commandButton>

				</p:toolbarGroup>
			</p:toolbar>

			<!-- <p:messages id="messages" showDetail="false" closable="true">
				<p:autoUpdate />
			</p:messages> -->

			<p:dataTable id="despesasTable"
				value="#{lancarDespesaFertilizanteBean.despesas}" var="despesa"
				style="margin-top: 20px" emptyMessage="Nenhuma despesa encontrada."
				rows="10" paginator="true" paginatorAlwaysVisible="true"
				paginatorPosition="bottom" rowsPerPageTemplate="5,10,15">

				<p:column headerText="Mês/Ano"
					style="width: 5px; text-align: center">
					<h:outputText value="#{despesa.data}">
						<f:convertDateTime type="localDate" pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>

				<p:column headerText="Fertilizante/Defensivo"
					style="width: 30px; text-align:left">
					<h:outputText value="#{despesa.fertilizante.tipo}" />
				</p:column>

				<p:column headerText="Nota Fiscal"
					style="width: 30px; text-align:left">
					<h:outputText value="#{despesa.notaFiscal.numero}" />
				</p:column>

				
				<p:column headerText="Operações"
					style="width: 10px; text-align: center">

					<p:commandButton title="Editar despesa"
						icon="pi pi-pencil"	            	
		            	oncomplete="PF('addDialogWidgetVar').show()"
		            	update="form:addDialog form:qdesTalhaoTable" 
		            	process="@this">
		            	<f:setPropertyActionListener
							target="#{lancarDespesaFertilizanteBean.despesaFertilizante}"
							value="#{despesa}"/>	
	            	</p:commandButton>

					<p:commandButton icon="pi pi-trash" title="Excluir"
						onclick="PF('confirmacaoExclusao').show();" process="@this"
						imediate="true">
						<f:setPropertyActionListener
							target="#{lancarDespesaFertilizanteBean.despesaFertilizante}"
							value="#{despesa}" />
					</p:commandButton>


				</p:column>

			</p:dataTable>


			<p:confirmDialog id="confirmacaoExclusaoDialog"
				widgetVar="confirmacaoExclusao"
				message="Tem certeza que deseja excluir a despesa 
	        			#{lancarDespesaFertilizanteBean.despesaFertilizante.id}?"
				header="Exclusão de máquina" severity="alert">

				<p:button icon="pi pi-thumbs-down" value="Não"
					onclick="PF('confirmacaoExclusao').hide(); return false;" />
				<p:commandButton icon="pi pi-thumbs-up" value="Sim" process="@this"
					update=":form:despesasTable"
					onclick="PF('confirmacaoExclusao').hide();"
					action="#{lancarDespesaFertilizanteBean.excluirDespesa}" />
			</p:confirmDialog>


			<p:dialog id="addDialog" widgetVar="addDialogWidgetVar"
				header="Cadastro de Despesa com Fertilizante" modal="true"
				resizable="true" closeOnEscape="true" showEffect="explode"
				hideEffect="explode" width="100%" position="center top"
				maximizable="true" height="100%" fitViewport="true"
				responsive="true">

				<p:messages id="messages" showDetail="false" closable="true">
				</p:messages>

				<p:panelGrid id="gridDespesa" columns="2"
					style="width: 100%; margin-top: 20px" columnClasses="rotulo, campo">

					<p:outputLabel for="data" value="Data" />
					<p:datePicker id="data"
						value="#{lancarDespesaFertilizanteBean.despesaFertilizante.data}"
						pattern="MM/yyyy" type="localDate" yearNavigator="true"
						monthNavigator="true" showIcon="true" required="true"
						yearRange="#{lancarDespesaFertilizanteBean.yearRange}"
						validatorMessage="A data é obrigatória.">
					</p:datePicker>


					<p:outputLabel value="Tipo Insumo" for="tipoInsumo" />
					<p:selectOneMenu id="tipoInsumo"
						value="#{lancarDespesaFertilizanteBean.auxiliar}">
						<f:selectItem itemLabel="Selecione o tipo" />
						<f:selectItems
							value="#{lancarDespesaFertilizanteBean.tiposInsumo}"
							var="tipoInsumo" itemLabel="#{tipoInsumo}"
							itemValue="#{tipoInsumo}" />

						<p:ajax listener="#{lancarDespesaFertilizanteBean.carregarTipos}"
							update="fertilizante" process="tipoInsumo" />
					</p:selectOneMenu>

					<p:outputLabel value="Fertilizante" for="fertilizante" />
					<h:panelGroup>
						<p:selectOneMenu id="fertilizante"
							value="#{lancarDespesaFertilizanteBean.despesaFertilizante.fertilizante}"
							required="true" validatorMessage="O fertilizante é obrigatório.">
							<f:selectItem itemLabel="Selecione o fertilizante" />
							<f:selectItems
								value="#{lancarDespesaFertilizanteBean.fertilizantes}"
								var="fertilizante" itemLabel="#{fertilizante.tipo}"
								itemValue="#{fertilizante}" />

							<p:ajax update="medida" process="fertilizante" />
						</p:selectOneMenu>
						<p:spacer width="10px" />
						<p:outputLabel id="medida"
							value="#{lancarDespesaFertilizanteBean.despesaFertilizante.fertilizante.medida}" />
		
					</h:panelGroup>

					<p:outputLabel value="Nota Fiscal" for="notaFiscal" />
					<h:panelGroup>
						<p:autoComplete id="notaFiscal" dropdown="true"
							value="#{lancarDespesaFertilizanteBean.numeroNF}"
							completeMethod="#{lancarDespesaFertilizanteBean.completeText}"
							scrollHeight="250" />


					</h:panelGroup>


				</p:panelGrid>
					<p:commandButton value="Salvar" id="botaoSalvar" icon="pi pi-save"
						style="margin-top: 10px; margin-bottom: 10px"
						actionListener="#{lancarDespesaFertilizanteBean.salvar}" 
						update="despesasTable messages qdesTalhaoTable"
						process="@this gridDespesa" >
							
							
					</p:commandButton>

					<p:commandButton value="Limpar" id="botaoLimpar" icon="pi pi-save"
						action="#{lancarDespesaFertilizanteBean.limpar}"
						update="gridDespesa" process="@this"
						style="margin-top: 10px; margin-bottom: 10px" />
					
				
				<p:dataTable id="qdesTalhaoTable"
					value="#{lancarDespesaFertilizanteBean.listaQdeTalhoes}"
					var="despesaTalhao"
					emptyMessage="Nenhum item encontrado."
					rows="10" paginator="true" paginatorAlwaysVisible="true"
					paginatorPosition="bottom" rowsPerPageTemplate="5,10,15"
					editable="true" editMode="cell" widgetVar="cellTalhoes">
					
					<p:ajax event="cellEdit" 
						listener="#{lancarDespesaFertilizanteBean.onCellEdit}" 
						update="qdesTalhaoTable" />
										
					<p:column headerText="Talhão" sortBy="#{despesaTalhao.talhao.nome}"
						style="width: 30px; text-align: left">
						<h:outputText value="#{despesaTalhao.talhao.nome}" />
					</p:column>
					
					<p:column headerText="Quantidade" sortBy="#{despesaTalhao.quantidade}"
							style="width: 30px; text-align: left">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{despesaTalhao.quantidade}" />
							</f:facet>
							<f:facet name="input">
								<p:inputNumber value="#{despesaTalhao.quantidade}" 
									style="width:100%" label="Quantidade"/>
							</f:facet>
						</p:cellEditor>
					</p:column>
					
				</p:dataTable>
				<p:toolbar id="tbQdeTalhao" >
				<p:toolbarGroup>
						<p:spacer width="10px" />
									
						<p:commandButton value="Salvar" id="botaoSalvarQdeTalhao" icon="pi pi-save"
							actionListener="#{lancarDespesaFertilizanteBean.salvarQuantidadeTalhao}"
							style="margin-top: 10px; margin-bottom: 10px"
							update="despesasTable messages"
							process="@this gridDespesa qdesTalhaoTable"/>
	
						<p:spacer width="10px" />
		
						<p:commandButton value="Limpar" id="botaoLimparQdeTalhao" icon="pi pi-save"
							style="margin-top: 10px; margin-bottom: 10px"
							action="#{lancarNotaFiscalBean.limpar}" 
							update="gridDespesa qdesTalhaoTable"
							process="@this"/>
							
						<p:spacer width="10px" />
							
						<p:commandButton value="Sair" id="botaoSairDespesa" icon="pi pi-save"
							onclick="PF('addDialogWidgetVar').hide();"
							update="despesasTable messages"
							process="@this" style="margin-top: 10px; margin-bottom: 10px" />
					</p:toolbarGroup>
				</p:toolbar>
			</p:dialog>


		</h:form>
	</ui:define>
</ui:composition>